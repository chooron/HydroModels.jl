<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>construct a ExpHydro Model · HydroModels.jl</title><meta name="title" content="construct a ExpHydro Model · HydroModels.jl"/><meta property="og:title" content="construct a ExpHydro Model · HydroModels.jl"/><meta property="twitter:title" content="construct a ExpHydro Model · HydroModels.jl"/><meta name="description" content="Documentation for HydroModels.jl."/><meta property="og:description" content="Documentation for HydroModels.jl."/><meta property="twitter:description" content="Documentation for HydroModels.jl."/><meta property="og:url" content="https://chooron.github.io/HydroModels.jl/dev/implements/build_exphydro_model_en/"/><meta property="twitter:url" content="https://chooron.github.io/HydroModels.jl/dev/implements/build_exphydro_model_en/"/><link rel="canonical" href="https://chooron.github.io/HydroModels.jl/dev/implements/build_exphydro_model_en/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">HydroModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Model Implementations</span><ul><li class="is-active"><a class="tocitem" href>construct a ExpHydro Model</a><ul class="internal"><li><a class="tocitem" href="#Introduction-to-ExpHydro-Model"><span>Introduction to ExpHydro Model</span></a></li><li><a class="tocitem" href="#Complete-Model-Construction-Process"><span>Complete Model Construction Process</span></a></li><li><a class="tocitem" href="#Step-by-Step-Analysis"><span>Step-by-Step Analysis</span></a></li></ul></li><li><a class="tocitem" href="../build_m50_model_en/">construct a M50 Model</a></li></ul></li><li><span class="tocitem">Run Models</span><ul><li><a class="tocitem" href="../../tutorials/run_a_bucket/">Run a Bucket Model</a></li><li><a class="tocitem" href="../../tutorials/run_a_exphydro_model/">Run ExpHydro Model</a></li></ul></li><li><span class="tocitem">Extent Content</span><ul><li><a class="tocitem" href="../../extent/framework_comparision_en/">Modeling Framework Comparisons</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model Implementations</a></li><li class="is-active"><a href>construct a ExpHydro Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>construct a ExpHydro Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/chooron/HydroModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/chooron/HydroModels.jl/blob/main/docs/src/implements/build_exphydro_model_en.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Build-an-ExpHydro-Model"><a class="docs-heading-anchor" href="#Build-an-ExpHydro-Model">Build an ExpHydro Model</a><a id="Build-an-ExpHydro-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Build-an-ExpHydro-Model" title="Permalink"></a></h1><h2 id="Introduction-to-ExpHydro-Model"><a class="docs-heading-anchor" href="#Introduction-to-ExpHydro-Model">Introduction to ExpHydro Model</a><a id="Introduction-to-ExpHydro-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-ExpHydro-Model" title="Permalink"></a></h2><p>This section demonstrates how to build a simple hydrological model - the ExpHydro model - using HydroModels.jl, serving as an introduction to conceptual model construction. The ExpHydro model consists of two computational modules: the Snowpack Bucket and the Soilwater Bucket. Their mathematical formulations are as follows:</p><p class="math-container">\[\begin{aligned}
&amp; \text{Snowpack Bucket:} \\
&amp; pet = 29.8 \cdot lday \cdot 24 \cdot 0.611 \cdot \frac{\exp(17.3 \cdot temp)}{temp + 237.3} \cdot \frac{1}{temp + 273.2} &amp;&amp; (1) \\
&amp; snowfall = H(T_{min} - temp) \cdot prcp &amp;&amp; (2) \\
&amp; rainfall = H(temp - T_{min}) \cdot prcp &amp;&amp; (3) \\
&amp; melt = H(temp - T_{max}) \cdot H(snowpack) \cdot \min(snowpack, D_f \cdot (temp - T_{max})) &amp;&amp; (4) \\
&amp; \frac{d(snowpack)}{dt} = snowfall - melt &amp;&amp; (5) \\
\\
&amp; \text{Soilwater Bucket:} \\
&amp; evap = H(soilwater) \cdot pet \cdot \min(1.0, \frac{soilwater}{S_{max}}) &amp;&amp; (6) \\
&amp; baseflow = H(soilwater) \cdot Q_{max} \cdot \exp(-f \cdot \max(0.0, S_{max} - soilwater)) &amp;&amp; (7) \\
&amp; surfaceflow = \max(0.0, soilwater - S_{max}) &amp;&amp; (8) \\
&amp; flow = baseflow + surfaceflow &amp;&amp; (9) \\
&amp; \frac{d(soilwater)}{dt} = rainfall + melt - evap - flow &amp;&amp; (10)
\end{aligned}\]</p><p>Where: <span>$H(x)$</span> represents the Heaviside step function, equals 1 when <span>$x &gt; 0$</span>, otherwise 0; <span>$T_{min}, T_{max}, D_f, S_{max}, Q_{max}, f$</span> are model parameters;<span>$temp, lday, prcp$</span> are input variables;<span>$snowpack, soilwater$</span> are state variables;Other variables are intermediate calculation variables</p><h2 id="Complete-Model-Construction-Process"><a class="docs-heading-anchor" href="#Complete-Model-Construction-Process">Complete Model Construction Process</a><a id="Complete-Model-Construction-Process-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-Model-Construction-Process" title="Permalink"></a></h2><pre><code class="language-julia hljs"># import packages
using HydroModels

# define variables and parameters
@variables temp lday pet prcp 
@variables snowfall rainfall melt evap baseflow surfaceflow flow
@variables snowpack soilwater
@parameters Tmin Tmax Df Smax Qmax f

# define snowpack bucket
fluxes_1 = [
    HydroFlux([temp, lday] =&gt; [pet], exprs=[29.8 * lday * 24 * 0.611 * exp((17.3 * temp) / (temp + 237.3)) / (temp + 273.2)]),
    HydroFlux([prcp, temp] =&gt; [snowfall, rainfall], [Tmin], exprs=[step_func(Tmin - temp) * prcp, step_func(temp - Tmin) * prcp]),
    HydroFlux([snowpack, temp] =&gt; [melt], [Tmax, Df], exprs=[step_func(temp - Tmax) * step_func(snowpack) * min(snowpack, Df * (temp - Tmax))]),
]
dfluxes_1 = [StateFlux([snowfall] =&gt; [melt], snowpack),]
snowpack_bucket = HydroBucket(name=:surface, funcs=fluxes_1, dfuncs=dfluxes_1)

# define soilwater bucket
fluxes_2 = [
    HydroFlux([soilwater, pet] =&gt; [evap], [Smax], exprs=[step_func(soilwater) * pet * min(1.0, soilwater / Smax)]),
    HydroFlux([soilwater] =&gt; [baseflow], [Smax, Qmax, f], exprs=[step_func(soilwater) * Qmax * exp(-f * (max(0.0, Smax - soilwater)))]),
    HydroFlux([soilwater] =&gt; [surfaceflow], [Smax], exprs=[max(0.0, soilwater - Smax)]),
    HydroFlux([baseflow, surfaceflow] =&gt; [flow], exprs=[baseflow + surfaceflow]),
]
dfluxes_2 = [StateFlux([rainfall, melt] =&gt; [evap, flow], soilwater)]
soilwater_bucket = HydroBucket(name=:soil, funcs=fluxes_2, dfuncs=dfluxes_2)

# define the Exp-Hydro model
exphydro_model = HydroModel(name=:exphydro, components=[snowpack_bucket, soilwater_bucket])</code></pre><h2 id="Step-by-Step-Analysis"><a class="docs-heading-anchor" href="#Step-by-Step-Analysis">Step-by-Step Analysis</a><a id="Step-by-Step-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Step-by-Step-Analysis" title="Permalink"></a></h2><p>Let&#39;s break down the model construction process into detailed steps.</p><p>First, we need to import the HydroModels.jl dependency:</p><pre><code class="language-julia hljs">using HydroModels</code></pre><p>By importing the HydroModels module, we gain direct access to types defined in HydroFlux, StateFlux, HydroBucket, and HydroModel modules. Additionally, the package exports macros from ModelingToolkit.jl such as @variables and @parameters, which are used for defining and manipulating variables and parameters in hydrological models:</p><pre><code class="language-julia hljs">@variables temp lday prcp 
@variables snowfall rainfall melt evap baseflow surfaceflow flow pet
@variables snowpack soilwater
@parameters Tmin Tmax Df Smax Qmax f</code></pre><p>In this code segment, we define all variables used in the ExpHydro model, including:</p><ul><li>Input variables: temperature (<code>temp</code>), day length (<code>lday</code>), and precipitation (<code>prcp</code>)</li><li>Intermediate calculation variables: <code>pet</code>, <code>snowfall</code>, <code>rainfall</code>, <code>melt</code>, <code>evap</code>, <code>baseflow</code>, <code>surfaceflow</code>, <code>flow</code></li><li>State variables: <code>snowpack</code> and <code>soilwater</code></li><li>Model parameters: <code>Tmin</code>, <code>Tmax</code>, <code>Df</code>, <code>Smax</code>, <code>Qmax</code>, and <code>f</code></li></ul><p>The definition of <code>HydroFlux</code> requires determining input/output variables and model parameters based on calculation formulas. For example, in the rain-snow partitioning formula, the input variables are <code>prcp</code> and <code>temp</code>, output variables are <code>snowfall</code> and <code>rainfall</code>, and the model parameter is <code>Tmin</code>. The formula translation to <code>HydroFlux</code> looks like this:</p><pre><code class="language-julia hljs">split_flux = HydroFlux([prcp, temp] =&gt; [snowfall, rainfall], [Tmin], exprs=[step_func(Tmin - temp) * prcp, step_func(temp - Tmin) * prcp])</code></pre><p>The definition of <code>StateFlux</code> is based on the balance equation of state variables. Generally, the balance equation equates the rate of change of the state variable to the difference between input and output fluxes. For example, the balance equation for <code>snowpack</code> is the difference between <code>snowfall</code> and <code>melt</code>. The formula translation to <code>StateFlux</code> looks like this:</p><pre><code class="language-julia hljs">snowpack_dflux = StateFlux([snowfall] =&gt; [melt], snowpack)</code></pre><p>Next, we define the model calculation formulas using <code>HydroFlux</code> and <code>StateFlux</code>, and integrate them into <code>HydroBucket</code> to create the Snowpack Bucket and Soilwater Bucket components:</p><pre><code class="language-julia hljs"># define snowpack bucket
fluxes_1 = [
    HydroFlux([temp, lday] =&gt; [pet], exprs=[29.8 * lday * 24 * 0.611 * exp((17.3 * temp) / (temp + 237.3)) / (temp + 273.2)]),
    HydroFlux([prcp, temp] =&gt; [snowfall, rainfall], [Tmin], exprs=[step_func(Tmin - temp) * prcp, step_func(temp - Tmin) * prcp]),
    HydroFlux([snowpack, temp] =&gt; [melt], [Tmax, Df], exprs=[step_func(temp - Tmax) * step_func(snowpack) * min(snowpack, Df * (temp - Tmax))]),
]
dfluxes_1 = [StateFlux([snowfall] =&gt; [melt], snowpack),]
snowpack_bucket = HydroBucket(name=:surface, funcs=fluxes_1, dfuncs=dfluxes_1)

# define soilwater bucket
fluxes_2 = [
    HydroFlux([soilwater, pet] =&gt; [evap], [Smax], exprs=[step_func(soilwater) * pet * min(1.0, soilwater / Smax)]),
    HydroFlux([soilwater] =&gt; [baseflow], [Smax, Qmax, f], exprs=[step_func(soilwater) * Qmax * exp(-f * (max(0.0, Smax - soilwater)))]),
    HydroFlux([soilwater] =&gt; [surfaceflow], [Smax], exprs=[max(0.0, soilwater - Smax)]),
    HydroFlux([baseflow, surfaceflow] =&gt; [flow], exprs=[baseflow + surfaceflow]),
]
dfluxes_2 = [StateFlux([rainfall, melt] =&gt; [evap, flow], soilwater)]
soilwater_bucket = HydroBucket(name=:soil, funcs=fluxes_2, dfuncs=dfluxes_2)</code></pre><p>The construction of <code>HydroBucket</code> consists of <code>HydroFlux</code> and <code>StateFlux</code>, where <code>HydroFlux</code> defines the model&#39;s calculation formulas, and <code>StateFlux</code> defines the balance equations for state variables.</p><p>Finally, we combine the <code>HydroBucket</code> components into a <code>HydroModel</code> to create the complete ExpHydro model:</p><pre><code class="language-julia hljs"># define the Exp-Hydro model
exphydro_model = HydroModel(name=:exphydro, components=[snowpack_bucket, soilwater_bucket])</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../build_m50_model_en/">construct a M50 Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 11 December 2024 02:12">Wednesday 11 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
